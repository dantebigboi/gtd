<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTD –°–∏—Å—Ç–µ–º–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css">
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        header { background: #2c3e50; color: white; padding: 1rem; text-align: center; }
        nav a { color: white; margin: 0 10px; text-decoration: none; cursor: pointer; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .tab { display: none; }
        .active-tab { display: block; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–¥–∞—á (GTD) */
        .columns { display: flex; gap: 20px; flex-wrap: wrap; }
        .column { flex: 1; min-width: 250px; background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tasks { min-height: 100px; margin: 10px 0; }
        .task { background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 8px; cursor: move; }
        .task-actions button { background: none; border: none; cursor: pointer; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±—é–¥–∂–µ—Ç–∞ */
        .expense-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫-–ª–∏—Å—Ç–æ–≤ */
        .checklist { margin-bottom: 20px; }
        .checklist-item { display: flex; align-items: center; margin: 5px 0; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) { .columns { flex-direction: column; } }
    </style>
</head>
<body>
    <header>
        <h1>GTD –°–∏—Å—Ç–µ–º–∞</h1>
        <nav>
            <a onclick="showTab('tasks')">–ó–∞–¥–∞—á–∏</a>
            <a onclick="showTab('checklists')">–ß–µ–∫-–ª–∏—Å—Ç—ã</a>
            <a onclick="showTab('budget')">–ë—é–¥–∂–µ—Ç</a>
        </nav>
    </header>

    <div class="container">
        <!-- –í–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞—á -->
        <div id="tasks" class="tab active-tab">
            <div class="controls">
                <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á...">
                <button id="clear-done">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
            </div>
            <div class="columns" id="columns">
                <div class="column" id="inbox">
                    <h2>üì• –í—Ö–æ–¥—è—â–∏–µ</h2>
                    <div class="tasks" id="inbox-tasks"></div>
                    <input type="text" class="new-task-input" placeholder="+ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞">
                </div>
                <div class="column" id="in-progress">
                    <h2>‚ö° –í —Ä–∞–±–æ—Ç–µ</h2>
                    <div class="tasks" id="in-progress-tasks"></div>
                </div>
                <div class="column" id="done">
                    <h2>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</h2>
                    <div class="tasks" id="done-tasks"></div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —á–µ–∫-–ª–∏—Å—Ç–æ–≤ -->
        <div id="checklists" class="tab">
            <div class="checklist-form">
                <input type="text" id="checklist-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞">
                <button onclick="addChecklist()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
            <div class="checklists" id="checklists-container"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –±—é–¥–∂–µ—Ç–∞ -->
        <div id="budget" class="tab">
            <div class="budget-form">
                <input type="text" id="expense-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="number" id="expense-amount" placeholder="–°—É–º–º–∞">
                <button onclick="addExpense()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div class="expense-list" id="expense-list"></div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Dragula –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // ===== –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ =====
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active-tab'));
            document.getElementById(tabId).classList.add('active-tab');
        }

        // ===== –õ–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á (GTD) =====
        let tasks = JSON.parse(localStorage.getItem('gtd-tasks')) || [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Drag & Drop
        dragula([
            document.getElementById('inbox-tasks'),
            document.getElementById('in-progress-tasks'),
            document.getElementById('done-tasks')
        ]).on('drop', (el, target) => {
            const taskId = el.dataset.id;
            const newStatus = target.parentElement.id;
            updateTaskStatus(taskId, newStatus);
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        document.querySelector('.new-task-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.target.value.trim()) {
                tasks.push({
                    id: Date.now().toString(),
                    text: e.target.value,
                    status: 'inbox',
                    createdAt: new Date().toISOString()
                });
                saveTasks();
                renderTasks();
                e.target.value = '';
            }
        });

        // –†–µ–Ω–¥–µ—Ä –∑–∞–¥–∞—á
        function renderTasks() {
            const columns = {
                'inbox': document.getElementById('inbox-tasks'),
                'in-progress': document.getElementById('in-progress-tasks'),
                'done': document.getElementById('done-tasks')
            };

            Object.values(columns).forEach(col => col.innerHTML = '');
            
            tasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'task';
                taskEl.dataset.id = task.id;
                taskEl.innerHTML = `
                    <div class="task-text">${task.text}</div>
                    <div class="task-actions">
                        <button onclick="editTask('${task.id}')">‚úèÔ∏è</button>
                        <button onclick="deleteTask('${task.id}')">üóëÔ∏è</button>
                    </div>
                `;
                columns[task.status].appendChild(taskEl);
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
        function saveTasks() {
            localStorage.setItem('gtd-tasks', JSON.stringify(tasks));
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function deleteTask(id) {
            tasks = tasks.filter(task => task.id !== id);
            saveTasks();
            renderTasks();
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É:', task.text);
            if (newText !== null) {
                task.text = newText.trim();
                saveTasks();
                renderTasks();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
        function updateTaskStatus(id, newStatus) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = newStatus;
                saveTasks();
            }
        }

        // ===== –õ–æ–≥–∏–∫–∞ —á–µ–∫-–ª–∏—Å—Ç–æ–≤ =====
        let checklists = JSON.parse(localStorage.getItem('gtd-checklists')) || [];

        function renderChecklists() {
            const container = document.getElementById('checklists-container');
            container.innerHTML = '';
            
            checklists.forEach(checklist => {
                const checklistEl = document.createElement('div');
                checklistEl.className = 'checklist';
                checklistEl.innerHTML = `
                    <h3>${checklist.name}</h3>
                    <ul id="checklist-${checklist.id}"></ul>
                    <input type="text" data-checklist-id="${checklist.id}" placeholder="+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç" onkeypress="if(event.key=='Enter') addChecklistItem('${checklist.id}', this)">
                `;
                container.appendChild(checklistEl);

                const itemsList = document.getElementById(`checklist-${checklist.id}`);
                checklist.items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'checklist-item';
                    li.innerHTML = `
                        <input type="checkbox" ${item.done ? 'checked' : ''} 
                               onchange="toggleChecklistItem('${checklist.id}', '${item.id}')">
                        <span>${item.text}</span>
                        <button onclick="removeChecklistItem('${checklist.id}', '${item.id}')">üóëÔ∏è</button>
                    `;
                    itemsList.appendChild(li);
                });
            });
        }

        function addChecklist() {
            const name = document.getElementById('checklist-name').value;
            if (name) {
                checklists.push({
                    id: Date.now().toString(),
                    name,
                    items: []
                });
                saveChecklists();
                renderChecklists();
                document.getElementById('checklist-name').value = '';
            }
        }

        function addChecklistItem(checklistId, inputEl) {
            if (inputEl.value.trim()) {
                const checklist = checklists.find(c => c.id === checklistId);
                if (checklist) {
                    checklist.items.push({
                        id: Date.now().toString(),
                        text: inputEl.value.trim(),
                        done: false
                    });
                    saveChecklists();
                    renderChecklists();
                    inputEl.value = '';
                }
            }
        }

        function toggleChecklistItem(checklistId, itemId) {
            const checklist = checklists.find(c => c.id === checklistId);
            if (checklist) {
                const item = checklist.items.find(i => i.id === itemId);
                if (item) item.done = !item.done;
                saveChecklists();
            }
        }

        function removeChecklistItem(checklistId, itemId) {
            const checklist = checklists.find(c => c.id === checklistId);
            if (checklist) {
                checklist.items = checklist.items.filter(i => i.id !== itemId);
                saveChecklists();
                renderChecklists();
            }
        }

        function saveChecklists() {
            localStorage.setItem('gtd-checklists', JSON.stringify(checklists));
        }

        // ===== –õ–æ–≥–∏–∫–∞ –±—é–¥–∂–µ—Ç–∞ =====
        let expenses = JSON.parse(localStorage.getItem('gtd-expenses')) || [];

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            
            expenses.forEach(exp => {
                const item = document.createElement('div');
                item.className = 'expense-item';
                item.innerHTML = `
                    <span>${exp.name}</span>
                    <span>${exp.amount} ‚ÇΩ</span>
                    <button onclick="removeExpense('${exp.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                list.appendChild(item);
            });
        }

        function addExpense() {
            const name = document.getElementById('expense-name').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if (name && amount) {
                expenses.push({
                    id: Date.now().toString(),
                    name,
                    amount
                });
                saveExpenses();
                renderExpenses();
                document.getElementById('expense-name').value = '';
                document.getElementById('expense-amount').value = '';
            }
        }

        function removeExpense(id) {
            expenses = expenses.filter(exp => exp.id !== id);
            saveExpenses();
            renderExpenses();
        }

        function saveExpenses() {
            localStorage.setItem('gtd-expenses', JSON.stringify(expenses));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            renderTasks();
            renderChecklists();
            renderExpenses();
        });
    </script>
</body>
</html>
